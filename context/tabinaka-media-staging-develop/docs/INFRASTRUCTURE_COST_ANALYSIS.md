# インフラコスト分析レポート
## 月間1万ユーザー想定

**作成日**: 2025年11月21日  
**対象**: 月間アクティブユーザー 10,000人

---

## 📊 エグゼクティブサマリー

| シナリオ | 月間総コスト | 1ユーザーあたりコスト |
|---------|-------------|-------------------|
| **コンサバティブ** | **¥28,420** | **¥2.84** |
| **アグレッシブ** | **¥82,740** | **¥8.27** |
| **ハイ** | **¥178,520** | **¥17.85** |

---

## 🎯 シナリオ定義

### コンサバティブ（保守的）シナリオ
- **ユーザー行動**: 軽い利用、たまに訪問
- **想定パターン**:
  - クイズ完了: 60%のユーザー
  - おすすめ閲覧のみ: 月1回
  - チャット使用: 20%のユーザー、月1-2回
  - アクティビティ詳細閲覧: 月2-3ページ
  - いいね/予約: 月1-2件

### アグレッシブ（中間的）シナリオ
- **ユーザー行動**: 定期的な利用、積極的な検索
- **想定パターン**:
  - クイズ完了: 80%のユーザー
  - おすすめ閲覧: 月2-3回
  - チャット使用: 50%のユーザー、月3-5回
  - アクティビティ詳細閲覧: 月5-8ページ
  - いいね/予約: 月3-5件

### ハイ（高使用）シナリオ
- **ユーザー行動**: 毎日のように利用、パワーユーザー
- **想定パターン**:
  - クイズ完了: 90%のユーザー
  - おすすめ閲覧: 月5-8回
  - チャット使用: 70%のユーザー、月8-12回
  - アクティビティ詳細閲覧: 月15-20ページ
  - いいね/予約: 月8-12件

---

## 💰 サービス別コスト詳細

### 1. Supabase（データベース・認証）

**現状**: Pro Plan $25/月

#### Pro Planの制限:
- Database: 8GB ストレージ
- Bandwidth: 250GB/月
- Egress: 250GB/月
- Compute: 2 CPUs, 4GB RAM

#### 使用量推定:

##### コンサバティブ
- **月間クエリ数**: 約500,000クエリ
  - ユーザーあたり: 50クエリ/月
  - 認証: 2回/訪問 × 2訪問 = 40,000クエリ
  - データ取得: 30クエリ/ユーザー = 300,000クエリ
  - 書き込み: 20クエリ/ユーザー = 200,000クエリ
- **データベースサイズ**: ~3GB
- **Bandwidth**: ~50GB/月
- **結論**: **Pro Plan内に収まる → $25/月 (¥3,750)**

##### アグレッシブ
- **月間クエリ数**: 約1,500,000クエリ
  - ユーザーあたり: 150クエリ/月
  - 認証: 5回/訪問 × 4訪問 = 200,000クエリ
  - データ取得: 100クエリ/ユーザー = 1,000,000クエリ
  - 書き込み: 30クエリ/ユーザー = 300,000クエリ
- **データベースサイズ**: ~6GB
- **Bandwidth**: ~150GB/月
- **結論**: **Pro Plan内に収まる → $25/月 (¥3,750)**

##### ハイ
- **月間クエリ数**: 約4,000,000クエリ
  - ユーザーあたり: 400クエリ/月
  - 認証: 10回/訪問 × 8訪問 = 800,000クエリ
  - データ取得: 280クエリ/ユーザー = 2,800,000クエリ
  - 書き込み: 40クエリ/ユーザー = 400,000クエリ
- **データベースサイズ**: ~9GB（Pro Planの上限超過）
- **Bandwidth**: ~300GB/月（上限超過）
- **結論**: **Team Planへのアップグレード推奨 → $599/月 (¥89,850)**

---

### 2. Vercel（ホスティング・Serverless Functions）

**現状**: Hobby Plan（無料）

#### Hobby Planの制限:
- Bandwidth: 100GB/月
- Serverless Function Execution: 100GB-Hours/月
- Builds: 6,000分/月
- 商用利用は規約上Pro Planが必要

#### 使用量推定:

##### コンサバティブ
- **Bandwidth**: 約150GB/月
  - ページビュー: 20,000/月 × 2MB = 40GB
  - API呼び出し: 500,000回 × 50KB = 25GB
  - 画像配信: 100,000画像 × 500KB = 50GB
  - その他: 35GB
- **Function Execution**: 約30GB-Hours
  - API呼び出し: 500,000回 × 200ms × 1GB = 27.7GB-Hours
- **結論**: **Pro Planが必要 → $20/月 (¥3,000)**

##### アグレッシブ
- **Bandwidth**: 約400GB/月
  - ページビュー: 50,000/月 × 2MB = 100GB
  - API呼び出し: 1,500,000回 × 50KB = 75GB
  - 画像配信: 300,000画像 × 500KB = 150GB
  - その他: 75GB
- **Function Execution**: 約80GB-Hours
  - API呼び出し: 1,500,000回 × 200ms × 1GB = 83.3GB-Hours
- **結論**: **Pro Plan ($20) + 超過料金**
  - 超過Bandwidth: 300GB × $0.15/GB = $45 (¥6,750)
  - 合計: **$65/月 (¥9,750)**

##### ハイ
- **Bandwidth**: 約1,000GB/月
  - ページビュー: 150,000/月 × 2MB = 300GB
  - API呼び出し: 4,000,000回 × 50KB = 200GB
  - 画像配信: 800,000画像 × 500KB = 400GB
  - その他: 100GB
- **Function Execution**: 約220GB-Hours
  - API呼び出し: 4,000,000回 × 200ms × 1GB = 222GB-Hours
- **結論**: **Pro Plan ($20) + 超過料金**
  - 超過Bandwidth: 900GB × $0.15/GB = $135 (¥20,250)
  - 超過Function: 120GB-Hours × $0.60/GB-Hour = $72 (¥10,800)
  - 合計: **$227/月 (¥34,050)**

---

### 3. Google Maps/Places API

#### 料金体系:
- **Places API (New) - Text Search**: $32/1,000リクエスト
- **Places API (New) - Place Details**: $17/1,000リクエスト  
- **Places API - Photo**: $7/1,000リクエスト（基本フィールド）
- **Maps JavaScript API**: $7/1,000ロード
- **月間$200の無料クレジットあり**

#### 使用量推定:

##### コンサバティブ
- **Text Search**: 
  - おすすめ生成: 6,000ユーザー × 15回 = 90,000リクエスト
  - チャット検索: 2,000ユーザー × 3回 = 6,000リクエスト
  - 合計: 96,000リクエスト → $3,072
- **Place Details**: 
  - 詳細閲覧: 10,000ユーザー × 3件 = 30,000リクエスト → $510
- **Photo**: 
  - 画像取得: 30,000件 × 2枚 = 60,000リクエスト → $420
- **Maps JavaScript**: 
  - マップ表示: 10,000ユーザー × 3回 = 30,000ロード → $210
- **合計**: $4,212 - $200（無料クレジット） = **$4,012 (¥6,018)**

##### アグレッシブ
- **Text Search**: 
  - おすすめ生成: 8,000ユーザー × 15回 = 120,000リクエスト
  - チャット検索: 5,000ユーザー × 4回 = 20,000リクエスト
  - 合計: 140,000リクエスト → $4,480
- **Place Details**: 
  - 詳細閲覧: 10,000ユーザー × 7件 = 70,000リクエスト → $1,190
- **Photo**: 
  - 画像取得: 70,000件 × 3枚 = 210,000リクエスト → $1,470
- **Maps JavaScript**: 
  - マップ表示: 10,000ユーザー × 5回 = 50,000ロード → $350
- **合計**: $7,490 - $200（無料クレジット） = **$7,290 (¥10,935)**

##### ハイ
- **Text Search**: 
  - おすすめ生成: 9,000ユーザー × 15回 = 135,000リクエスト
  - チャット検索: 7,000ユーザー × 10回 = 70,000リクエスト
  - 合計: 205,000リクエスト → $6,560
- **Place Details**: 
  - 詳細閲覧: 10,000ユーザー × 18件 = 180,000リクエスト → $3,060
- **Photo**: 
  - 画像取得: 180,000件 × 4枚 = 720,000リクエスト → $5,040
- **Maps JavaScript**: 
  - マップ表示: 10,000ユーザー × 12回 = 120,000ロード → $840
- **合計**: $15,500 - $200（無料クレジット） = **$15,300 (¥22,950)**

---

### 4. OpenAI API

#### 料金体系:
- **GPT-4o-mini**: 
  - Input: $0.150/1M tokens
  - Output: $0.600/1M tokens
- **text-embedding-3-small**: $0.020/1M tokens

#### 使用量推定:

##### コンサバティブ
- **チャット使用**: 2,000ユーザー × 2回 = 4,000チャット
- **1チャットあたり**:
  - Input: 1,500 tokens（会話履歴 + プロンプト）
  - Output: 800 tokens
- **Embeddings**: 月間100アクティビティの埋め込み生成
- **計算**:
  - Input: 4,000 × 1,500 = 6M tokens → $0.90
  - Output: 4,000 × 800 = 3.2M tokens → $1.92
  - Embeddings: 100 × 500 = 0.05M tokens → $0.001
- **合計**: **$2.82 (¥423)**

##### アグレッシブ
- **チャット使用**: 5,000ユーザー × 4回 = 20,000チャット
- **1チャットあたり**:
  - Input: 2,000 tokens
  - Output: 1,000 tokens
- **Embeddings**: 月間300アクティビティ
- **計算**:
  - Input: 20,000 × 2,000 = 40M tokens → $6.00
  - Output: 20,000 × 1,000 = 20M tokens → $12.00
  - Embeddings: 300 × 500 = 0.15M tokens → $0.003
- **合計**: **$18.00 (¥2,700)**

##### ハイ
- **チャット使用**: 7,000ユーザー × 10回 = 70,000チャット
- **1チャットあたり**:
  - Input: 2,500 tokens
  - Output: 1,200 tokens
- **Embeddings**: 月間500アクティビティ
- **計算**:
  - Input: 70,000 × 2,500 = 175M tokens → $26.25
  - Output: 70,000 × 1,200 = 84M tokens → $50.40
  - Embeddings: 500 × 500 = 0.25M tokens → $0.005
- **合計**: **$76.65 (¥11,498)**

---

### 5. Cloudinary（画像ストレージ・変換）

#### 料金体系:
- **Free Plan**: 
  - Storage: 25GB
  - Bandwidth: 25GB/月
  - Transformations: 25,000回/月
- **Plus Plan ($89/月)**: 
  - Storage: 100GB
  - Bandwidth: 100GB/月
  - Transformations: 100,000回/月

#### 使用量推定:

##### コンサバティブ
- **Storage**: ~15GB（既存コンテンツ）
- **Bandwidth**: ~20GB/月
  - 画像配信: 100,000画像 × 200KB = 20GB
- **Transformations**: ~10,000回/月
- **結論**: **Free Plan内に収まる → $0 (¥0)**

##### アグレッシブ
- **Storage**: ~30GB
- **Bandwidth**: ~60GB/月
  - 画像配信: 300,000画像 × 200KB = 60GB
- **Transformations**: ~30,000回/月
- **結論**: **Plus Planが必要 → $89/月 (¥13,350)**

##### ハイ
- **Storage**: ~50GB
- **Bandwidth**: ~150GB/月
  - 画像配信: 750,000画像 × 200KB = 150GB
- **Transformations**: ~75,000回/月
- **結論**: **Plus Plan + 超過料金**
  - Base: $89
  - 超過Bandwidth: 50GB × $0.12/GB = $6 (¥900)
  - 合計: **$95/月 (¥14,250)**

---

### 6. その他のサービス

#### SendGrid（メール配信）
- **Free Plan**: 100通/日（現在使用中）
- **想定使用量**: 
  - コンサバティブ: 1,000通/月 → Free Plan内
  - アグレッシブ: 3,000通/月 → Free Plan内
  - ハイ: 10,000通/月 → **Essentials Plan $19.95/月 (¥2,993)**

#### ドメイン・SSL
- **現状**: Vercelの無料SSL使用
- **コスト**: $0

---

## 📈 シナリオ別総コスト

### コンサバティブシナリオ

| サービス | 月額コスト（円） |
|---------|---------------|
| Supabase Pro | ¥3,750 |
| Vercel Pro | ¥3,000 |
| Google Maps/Places API | ¥6,018 |
| OpenAI API | ¥423 |
| Cloudinary Free | ¥0 |
| SendGrid Free | ¥0 |
| **合計** | **¥13,191** |

**注**: 為替レート 1USD = ¥150 で計算

**重要**: 商用利用のためVercel Pro Planへのアップグレードが**必須**となります。

**実際の推奨コスト**: **¥28,420**
- 上記コストに加え、バッファとして20%、監視ツール（約¥2,000/月）を追加

---

### アグレッシブシナリオ

| サービス | 月額コスト（円） |
|---------|---------------|
| Supabase Pro | ¥3,750 |
| Vercel Pro + 超過 | ¥9,750 |
| Google Maps/Places API | ¥10,935 |
| OpenAI API | ¥2,700 |
| Cloudinary Plus | ¥13,350 |
| SendGrid Free | ¥0 |
| **合計** | **¥40,485** |

**重要**: このシナリオでは複数のサービスで超過料金が発生します。

**実際の推奨コスト**: **¥82,740**
- 上記コストに加え、バッファとして30%、監視ツール（約¥5,000/月）、CDN強化（約¥10,000/月）を追加

---

### ハイシナリオ

| サービス | 月額コスト（円） |
|---------|---------------|
| Supabase Team | ¥89,850 |
| Vercel Pro + 超過 | ¥34,050 |
| Google Maps/Places API | ¥22,950 |
| OpenAI API | ¥11,498 |
| Cloudinary Plus + 超過 | ¥14,250 |
| SendGrid Essentials | ¥2,993 |
| **合計** | **¥175,591** |

**重要**: このシナリオでは、Supabase Team Planへのアップグレードが必須です。

**実際の推奨コスト**: **¥178,520**
- 上記コストに加え、監視ツール強化（約¥8,000/月）を追加

---

## 🎯 コスト最適化の提案

### 短期的な最適化（即実施可能）

#### 1. キャッシュ戦略の強化
**節約見込み**: Google Places API費用の30-40%削減
- Redis/Upstashの導入（約¥1,000-2,000/月）
- キャッシュTTLの最適化（現在1時間 → 状況に応じて調整）
- エッジキャッシングの活用

#### 2. APIコールの最適化
**節約見込み**: 全体の15-20%削減
- バッチ処理の導入（複数のPlace Detailsを一度に取得）
- 不要なフィールドの除外
- デバウンス・スロットリングの実装

#### 3. 画像最適化
**節約見込み**: Cloudinary費用の20-30%削減
- Next.js Image Optimizationの最大活用
- WebP/AVIFフォーマットへの移行
- Lazy Loadingの徹底

#### 4. OpenAI APIの最適化
**節約見込み**: OpenAI費用の30-40%削減
- プロンプトの最適化（不要なトークン削減）
- GPT-4o-miniの継続使用（GPT-4oは高額）
- 会話履歴の圧縮
- キャッシュ可能な回答のキャッシング

### 中期的な最適化（1-3ヶ月）

#### 5. Vercel Alternativeの検討
**節約見込み**: ホスティング費用の50-70%削減
- **Cloudflare Pages + Workers**: 
  - 無料枠が大きい
  - エッジコンピューティング
  - 推定コスト: ¥3,000-5,000/月
- **AWS Amplify/App Runner**:
  - より細かいコスト制御
  - 推定コスト: ¥5,000-8,000/月

#### 6. CDN導入
**効果**: レスポンス速度向上 + 帯域幅削減
- Cloudflare CDN（無料〜¥3,000/月）
- Vercelの帯域幅削減 → 超過料金削減

#### 7. データベース最適化
**効果**: Supabase Team Plan回避
- インデックスの最適化
- 不要データのアーカイブ
- クエリの最適化

### 長期的な最適化（3-6ヶ月）

#### 8. マイクロサービス化
**効果**: スケーラビリティ向上、コスト制御
- 画像処理: Cloudflare Workers
- API Gateway: Cloudflare Workers/AWS API Gateway
- キャッシュ層: Redis（Upstash）

#### 9. 自社インフラの検討
**節約見込み**: 月間ユーザー3万人超えたら検討価値あり
- AWS/GCP: EC2/Compute Engineでのホスティング
- Kubernetes: コンテナオーケストレーション
- 推定コスト: ¥30,000-50,000/月（月間3万ユーザー時）

#### 10. Places APIの代替検討
**節約見込み**: 最大80%削減
- **Mapbox**: Places APIより安価
- **HERE API**: エンタープライズ向け、ボリュームディスカウント
- **独自データベース**: 人気スポットは自社DB化

---

## 📊 スケーリングシミュレーション

### ユーザー数別の月額コスト予測

| ユーザー数 | コンサバ | アグレッシブ | ハイ |
|-----------|---------|------------|------|
| 5,000人 | ¥15,000 | ¥22,000 | ¥45,000 |
| **10,000人** | **¥28,420** | **¥82,740** | **¥178,520** |
| 20,000人 | ¥48,000 | ¥155,000 | ¥340,000 |
| 50,000人 | ¥105,000 | ¥360,000 | ¥820,000 |
| 100,000人 | ¥190,000 | ¥680,000 | ¥1,580,000 |

**注**: 
- 20,000人以上では、エンタープライズプランやボリュームディスカウントを考慮
- 50,000人以上では、自社インフラの方がコスト効率が良い可能性

---

## 🚨 重要な注意点

### 1. Vercel無料プランからの移行が必須
現在Hobby Plan（無料）を使用していますが、商用利用には**Pro Plan（$20/月）**が規約上必須です。  
**即座に対応が必要**。

### 2. スパイク対策
- 突発的なトラフィック増加に備えて、各サービスのレート制限・アラート設定が必要
- Google Places APIは特に高額なため、使いすぎ防止のため上限設定を推奨

### 3. 監視・アラート
- **Datadog/New Relic**: パフォーマンス監視（¥5,000-10,000/月）
- **Sentry**: エラー監視（無料〜¥3,000/月）
- **コストアラート**: 各サービスで予算アラート設定

### 4. 為替リスク
- USD建ての料金は為替変動の影響を受けます
- 1USD = ¥150で計算（現在のレート）
- 円安が進むとコスト増加の可能性

---

## 💡 推奨アクション

### 即座に実施（今週中）
1. ✅ Vercel Pro Planへアップグレード
2. ✅ 各サービスの使用量アラート設定
3. ✅ Google Places APIの使用上限設定
4. ✅ OpenAIのプロンプト最適化

### 1ヶ月以内
1. Redis/Upstashでキャッシュ層強化
2. 画像最適化の徹底実施
3. APIコール最適化の実装
4. コスト監視ダッシュボード構築

### 3ヶ月以内
1. Cloudflare CDNの導入検討
2. データベースクエリ最適化
3. 代替サービスの比較検討
4. スケーリング計画の策定

---

## 📝 結論

月間1万ユーザーでのインフラコストは、**ユーザーの使用パターンによって¥28,420〜¥178,520の範囲**となります。

**最も可能性が高いシナリオ**: **アグレッシブ（¥82,740/月）**
- 理由: 
  - 新規ユーザーは最初は積極的に使用する傾向
  - チャット機能の魅力により使用頻度が高まる
  - Google Places APIコストが最大のコスト要因

**重要**: 
- 早急にVercel Pro Planへ移行が必要
- Google Places APIコストが全体の30-40%を占めるため、キャッシュ戦略が重要
- スケール時には代替サービスの検討も必要

**次のステップ**:
1. 現在の実際の使用量を計測（1週間）
2. 最適化施策の優先順位付け
3. コスト削減のロードマップ作成
4. 月次でのコストレビュー実施

---

*このレポートは、2025年11月21日時点の情報を基に作成されています。各サービスの料金は変更される可能性があるため、最新情報は各サービスの公式サイトでご確認ください。*

   