# ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãƒãƒƒãƒ— Ã— ãƒãƒ£ãƒƒãƒˆçµ±åˆ

## ã‚³ãƒ³ã‚»ãƒ—ãƒˆ

ãƒãƒ£ãƒƒãƒˆã§æ¤œç´¢ã—ãŸã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ã‚’ã€ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§åœ°å›³ä¸Šã«ãƒ”ãƒ³è¡¨ç¤ºã€‚
ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯åœ°å›³ã‚’è¦‹ãªãŒã‚‰ã€ã©ã“ã«ä½•ãŒã‚ã‚‹ã®ã‹ç›´æ„Ÿçš„ã«æŠŠæ¡ã§ãã‚‹ã€‚

---

## UI/UXãƒ‡ã‚¶ã‚¤ãƒ³

### ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆæ¡ˆï¼š2ãƒ‘ãƒãƒ«ãƒ‡ã‚¶ã‚¤ãƒ³

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Header                                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                          â”‚                                 â”‚
â”‚   ãƒãƒ£ãƒƒãƒˆãƒ‘ãƒãƒ«           â”‚      åœ°å›³ãƒ‘ãƒãƒ«                  â”‚
â”‚   (å·¦å´ 40%)              â”‚      (å³å´ 60%)                 â”‚
â”‚                          â”‚                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Bot: ä½•ã‚’ãŠæ¢ã—ã§ã™ã‹ï¼Ÿâ”‚ â”‚  â”‚                           â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚                           â”‚ â”‚
â”‚                          â”‚  â”‚         ğŸ—ºï¸                 â”‚ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚                           â”‚ â”‚
â”‚  â”‚ User: æ¸‹è°·ã®ã‚«ãƒ•ã‚§     â”‚ â”‚  â”‚        ğŸ“ ğŸ“ ğŸ“           â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚         ğŸ“                â”‚ â”‚
â”‚                          â”‚  â”‚                           â”‚ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚                           â”‚ â”‚
â”‚  â”‚ Bot: è¦‹ã¤ã‘ã¾ã—ãŸï¼   â”‚ â”‚  â”‚                           â”‚ â”‚
â”‚  â”‚                      â”‚ â”‚  â”‚                           â”‚ â”‚
â”‚  â”‚ [Card] Blue Bottle  â”‚ â”‚  â”‚                           â”‚ â”‚
â”‚  â”‚ [Card] Onibus       â”‚ â”‚  â”‚                           â”‚ â”‚
â”‚  â”‚ [Card] About Life   â”‚ â”‚  â”‚                           â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                          â”‚                                 â”‚
â”‚  [ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å…¥åŠ›æ¬„]       â”‚   [åœ°å›³ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«]              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œï¼šã‚¹ã‚¿ãƒƒã‚¯ãƒ‡ã‚¶ã‚¤ãƒ³

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Header             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                     â”‚
â”‚   ãƒãƒ£ãƒƒãƒˆã‚¨ãƒªã‚¢      â”‚
â”‚                     â”‚
â”‚  Bot: è¦‹ã¤ã‘ã¾ã—ãŸï¼ â”‚
â”‚                     â”‚
â”‚  [Tab: ãƒªã‚¹ãƒˆè¡¨ç¤º]   â”‚
â”‚  [Tab: åœ°å›³è¡¨ç¤º] âœ“  â”‚
â”‚                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                     â”‚
â”‚      ğŸ—ºï¸ åœ°å›³         â”‚
â”‚                     â”‚
â”‚    ğŸ“ ğŸ“ ğŸ“         â”‚
â”‚      ğŸ“             â”‚
â”‚                     â”‚
â”‚                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–æ©Ÿèƒ½

### 1. ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€£å‹•

```typescript
// ãƒãƒ£ãƒƒãƒˆçµæœãŒè¿”ã£ã¦ããŸã‚‰ã€å³åº§ã«åœ°å›³ã«ãƒ”ãƒ³è¡¨ç¤º
onChatResponse(activities: Activity[]) => {
  // åœ°å›³ã«ãƒãƒ¼ã‚«ãƒ¼è¿½åŠ 
  activities.forEach(activity => {
    addMarkerToMap(activity);
  });
  
  // å…¨ãƒãƒ¼ã‚«ãƒ¼ãŒè¦‹ãˆã‚‹ã‚ˆã†ã«åœ°å›³ã‚’èª¿æ•´
  fitBoundsToMarkers(activities);
}
```

### 2. ãƒ”ãƒ³ã®ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³

```typescript
// ãƒ”ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ â†’ è©³ç´°ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—è¡¨ç¤º
marker.onClick(() => {
  showInfoWindow({
    title: activity.title,
    image: activity.coverImage,
    rating: activity.rating,
    price: activity.price,
    distance: calculateDistance(userLocation, activity.location),
    button: "è©³ç´°ã‚’è¦‹ã‚‹",
    onButtonClick: () => router.push(`/experiences/${activity.slug}`)
  });
});

// ãƒ”ãƒ³ã«ãƒ›ãƒãƒ¼ â†’ ã‚«ãƒ¼ãƒ‰ã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆ
marker.onHover(() => {
  highlightChatCard(activity.id);
});
```

### 3. ãƒãƒ£ãƒƒãƒˆã‚«ãƒ¼ãƒ‰ã¨ã®åŒæ–¹å‘é€£å‹•

```typescript
// ã‚«ãƒ¼ãƒ‰ã‚’ãƒ›ãƒãƒ¼ â†’ åœ°å›³ã®ãƒ”ãƒ³ã‚’ãƒã‚¦ãƒ³ã‚¹
chatCard.onHover(() => {
  bounceMarker(activity.id);
  panToMarker(activity.id);
});

// ã‚«ãƒ¼ãƒ‰ã‚’ã‚¯ãƒªãƒƒã‚¯ â†’ åœ°å›³ã‚’ã‚ºãƒ¼ãƒ 
chatCard.onClick(() => {
  zoomToMarker(activity.id, zoomLevel: 16);
  openInfoWindow(activity.id);
});
```

### 4. ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°é€£å‹•

```typescript
// ãƒãƒ£ãƒƒãƒˆã§ã€Œ1000å††ä»¥å†…ã§çµã£ã¦ã€
onFilterChange(filters: Filters) => {
  // è©²å½“ã—ãªã„ãƒ”ãƒ³ã‚’ã‚°ãƒ¬ãƒ¼ã‚¢ã‚¦ãƒˆ
  markers.forEach(marker => {
    if (!matchesFilter(marker.activity, filters)) {
      marker.setOpacity(0.3);
      marker.setClickable(false);
    }
  });
}
```

---

## åœ°å›³ä¸Šã®ãƒ”ãƒ³è¡¨ç¤ºä»•æ§˜

### ã‚«ã‚¹ã‚¿ãƒ ãƒãƒ¼ã‚«ãƒ¼ãƒ‡ã‚¶ã‚¤ãƒ³

```typescript
// ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ã‚¿ã‚¤ãƒ—åˆ¥ã®ãƒ”ãƒ³ã‚¢ã‚¤ã‚³ãƒ³
const markerIcons = {
  'food': 'ğŸ½ï¸',
  'cafe': 'â˜•',
  'culture': 'ğŸ­',
  'shopping': 'ğŸ›ï¸',
  'nature': 'ğŸŒ³',
  'nightlife': 'ğŸº',
  'micro-experience': 'âœ¨', // æ–°ã—ã„ã‚«ãƒ†ã‚´ãƒªï¼
};

// ã‚«ã‚¹ã‚¿ãƒ ãƒãƒ¼ã‚«ãƒ¼ä½œæˆ
function createCustomMarker(activity: Activity) {
  return {
    position: { lat: activity.lat, lng: activity.lng },
    icon: {
      url: createMarkerSVG({
        emoji: markerIcons[activity.category],
        color: activity.price < 1000 ? '#22c55e' : '#3b82f6',
        selected: activity.selected,
      }),
      scaledSize: new google.maps.Size(40, 50),
    },
    animation: google.maps.Animation.DROP,
  };
}
```

### ãƒãƒ¼ã‚«ãƒ¼ã®ã‚«ã‚¹ã‚¿ãƒ SVG

```svg
<!-- ä¾¡æ ¼å¸¯ã§è‰²åˆ†ã‘ -->
<svg width="40" height="50">
  <path d="M20,0 C9,0 0,9 0,20 C0,35 20,50 20,50 C20,50 40,35 40,20 C40,9 31,0 20,0 Z" 
        fill="${color}" 
        stroke="white" 
        stroke-width="2"/>
  <text x="20" y="25" text-anchor="middle" font-size="20">
    ${emoji}
  </text>
  <!-- ä¾¡æ ¼ãƒãƒƒã‚¸ -->
  <circle cx="32" cy="10" r="8" fill="white"/>
  <text x="32" y="14" text-anchor="middle" font-size="10" fill="black">
    Â¥${price}
  </text>
</svg>
```

### ãƒãƒ¼ã‚«ãƒ¼ã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°

```typescript
// å¤šæ•°ã®ãƒ”ãƒ³ã‚’è‡ªå‹•ã§ã‚¯ãƒ©ã‚¹ã‚¿ãƒªãƒ³ã‚°
import { MarkerClusterer } from '@googlemaps/markerclusterer';

const markerCluster = new MarkerClusterer({
  map,
  markers,
  renderer: {
    render: ({ count, position }) => {
      return new google.maps.Marker({
        position,
        icon: {
          url: createClusterSVG(count),
          scaledSize: new google.maps.Size(50, 50),
        },
        label: {
          text: String(count),
          color: 'white',
          fontSize: '14px',
        },
      });
    },
  },
});
```

---

## ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—æƒ…å ±ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦

### ãƒ‡ã‚¶ã‚¤ãƒ³

```html
<!-- ãƒ”ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸã¨ãã®ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ— -->
<div class="info-window" style="width: 300px; padding: 0;">
  <img src="${activity.coverImage}" 
       style="width: 100%; height: 150px; object-fit: cover;"/>
  
  <div style="padding: 12px;">
    <h3 style="margin: 0 0 8px 0; font-size: 16px; font-weight: 600;">
      ${activity.title}
    </h3>
    
    <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
      <div style="display: flex; align-items: center;">
        â­ ${activity.rating}
      </div>
      <span style="color: #666;">â€¢</span>
      <div style="color: #10b981; font-weight: 600;">
        Â¥${activity.price}
      </div>
      <span style="color: #666;">â€¢</span>
      <div style="color: #666;">
        â±ï¸ ${activity.duration}
      </div>
    </div>
    
    <p style="color: #666; font-size: 14px; margin: 0 0 12px 0;">
      ğŸ“ ${activity.locationFromStation}
    </p>
    
    <button onclick="viewDetails('${activity.slug}')"
            style="width: 100%; padding: 8px; background: #3b82f6; color: white; 
                   border: none; border-radius: 6px; cursor: pointer;">
      è©³ç´°ã‚’è¦‹ã‚‹ â†’
    </button>
  </div>
</div>
```

---

## é«˜åº¦ãªåœ°å›³æ©Ÿèƒ½

### 1. ãƒ«ãƒ¼ãƒˆè¡¨ç¤º

```typescript
// ç¾åœ¨åœ°ã‹ã‚‰é¸æŠã—ãŸã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ã¾ã§ã®ãƒ«ãƒ¼ãƒˆè¡¨ç¤º
function showRoute(from: Location, to: Activity) {
  const directionsService = new google.maps.DirectionsService();
  const directionsRenderer = new google.maps.DirectionsRenderer({
    map,
    suppressMarkers: false,
    polylineOptions: {
      strokeColor: '#3b82f6',
      strokeWeight: 4,
    },
  });

  directionsService.route({
    origin: from,
    destination: { lat: to.lat, lng: to.lng },
    travelMode: google.maps.TravelMode.WALKING,
  }, (result, status) => {
    if (status === 'OK') {
      directionsRenderer.setDirections(result);
      
      // ãƒãƒ£ãƒƒãƒˆã«çµŒè·¯æƒ…å ±ã‚’è¡¨ç¤º
      const route = result.routes[0].legs[0];
      sendBotMessage(
        `å¾’æ­©${route.duration.text}ï¼ˆ${route.distance.text}ï¼‰ã§åˆ°ç€ã—ã¾ã™ï¼`
      );
    }
  });
}
```

### 2. ã‚¨ãƒªã‚¢ãƒã‚¤ãƒ©ã‚¤ãƒˆ

```typescript
// ãƒãƒ£ãƒƒãƒˆã§ã€Œæ¸‹è°·ã‚¨ãƒªã‚¢ã€ã¨è¨€ã‚ã‚ŒãŸã‚‰ã‚¨ãƒªã‚¢ã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆ
function highlightArea(areaName: string) {
  const polygon = new google.maps.Polygon({
    paths: getAreaBoundary(areaName), // æ¸‹è°·ã®å¢ƒç•Œåº§æ¨™
    strokeColor: '#3b82f6',
    strokeOpacity: 0.8,
    strokeWeight: 2,
    fillColor: '#3b82f6',
    fillOpacity: 0.15,
  });
  
  polygon.setMap(map);
}
```

### 3. ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—è¡¨ç¤º

```typescript
// äººæ°—ã‚¨ãƒªã‚¢ã‚’ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—ã§è¡¨ç¤º
import { HeatmapLayer } from '@googlemaps/js-api-loader';

const heatmapData = activities.map(activity => ({
  location: new google.maps.LatLng(activity.lat, activity.lng),
  weight: activity.popularityScore,
}));

const heatmap = new google.maps.visualization.HeatmapLayer({
  data: heatmapData,
  radius: 20,
  opacity: 0.6,
});

heatmap.setMap(map);
```

### 4. ãƒ¬ã‚¤ãƒ¤ãƒ¼åˆ‡ã‚Šæ›¿ãˆ

```typescript
// åœ°å›³ä¸Šã®ãƒ¬ã‚¤ãƒ¤ãƒ¼åˆ‡ã‚Šæ›¿ãˆ
const layers = {
  restaurants: new google.maps.Data(),
  cafes: new google.maps.Data(),
  culture: new google.maps.Data(),
  microExperiences: new google.maps.Data(), // æ–°ã—ã„ãƒ¬ã‚¤ãƒ¤ãƒ¼
};

// ãƒãƒ£ãƒƒãƒˆã§ã€Œã‚«ãƒ•ã‚§ã ã‘è¡¨ç¤ºã€
function toggleLayer(layerName: string, visible: boolean) {
  layers[layerName].setMap(visible ? map : null);
}
```

---

## ãƒãƒ£ãƒƒãƒˆ Ã— åœ°å›³ã®çµ±åˆã‚·ãƒŠãƒªã‚ª

### ã‚·ãƒŠãƒªã‚ª1: åŸºæœ¬æ¤œç´¢

```
User: ã€Œæ¸‹è°·ã§ã‚«ãƒ•ã‚§æ¢ã—ã¦ã‚‹ã€
  â†“
Bot: ã€Œæ¸‹è°·ã®ã‚«ãƒ•ã‚§ã‚’æ¤œç´¢ã—ã¦ã„ã¾ã™...ã€
  â†“ [åœ°å›³ãŒæ¸‹è°·ã«ç§»å‹•ã€ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³]
  â†“
Bot: ã€Œ5ã¤ã®ã‚«ãƒ•ã‚§ãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸï¼ã€
  â†“ [åœ°å›³ã«5ã¤ã®ãƒ”ãƒ³ãŒãƒ‰ãƒ­ãƒƒãƒ—ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã§è¡¨ç¤º]
  â†“ [ãƒãƒ£ãƒƒãƒˆã«5ã¤ã®ã‚«ãƒ¼ãƒ‰è¡¨ç¤º]
  â†“
User: [2ç•ªç›®ã®ã‚«ãƒ¼ãƒ‰ã«ãƒ›ãƒãƒ¼]
  â†“ [åœ°å›³ã®è©²å½“ãƒ”ãƒ³ãŒãƒã‚¦ãƒ³ã‚¹]
  â†“
User: [2ç•ªç›®ã®ã‚«ãƒ¼ãƒ‰ã‚’ã‚¯ãƒªãƒƒã‚¯]
  â†“ [åœ°å›³ãŒã‚ºãƒ¼ãƒ ã€ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—è¡¨ç¤º]
```

### ã‚·ãƒŠãƒªã‚ª2: ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°

```
User: ã€Œ1000å††ä»¥å†…ã«çµã£ã¦ã€
  â†“
Bot: ã€Œ1000å††ä»¥å†…ã®ã‚«ãƒ•ã‚§ã¯3ã¤ã‚ã‚Šã¾ã™ã€
  â†“ [åœ°å›³ä¸Šã§è©²å½“ã—ãªã„2ã¤ã®ãƒ”ãƒ³ãŒã‚°ãƒ¬ãƒ¼ã‚¢ã‚¦ãƒˆ]
  â†“ [è©²å½“ã™ã‚‹3ã¤ã®ãƒ”ãƒ³ãŒå¼·èª¿è¡¨ç¤º]
  â†“ [ãƒãƒ£ãƒƒãƒˆã«3ã¤ã®ã‚«ãƒ¼ãƒ‰è¡¨ç¤º]
```

### ã‚·ãƒŠãƒªã‚ª3: ä½ç½®ãƒ™ãƒ¼ã‚¹æ¤œç´¢

```
User: ã€Œä»Šã„ã‚‹å ´æ‰€ã‹ã‚‰è¿‘ã„é †ã§ã€
  â†“
Bot: ã€Œç¾åœ¨åœ°ã‚’å–å¾—ã—ã¦ã„ã¾ã™...ã€
  â†“ [ç¾åœ¨åœ°ã«é’ã„ãƒ‰ãƒƒãƒˆãƒãƒ¼ã‚«ãƒ¼è¡¨ç¤º]
  â†“
Bot: ã€Œä¸€ç•ªè¿‘ã„ã®ã¯200må…ˆã®Blue Bottleã§ã™ã€
  â†“ [åœ°å›³ã«ç¾åœ¨åœ°ã‹ã‚‰ã®ãƒ©ã‚¤ãƒ³ãŒè¡¨ç¤º]
  â†“ [æœ€å¯„ã‚Šã®ãƒ”ãƒ³ãŒãƒã‚¤ãƒ©ã‚¤ãƒˆ]
```

### ã‚·ãƒŠãƒªã‚ª4: ã‚¨ãƒªã‚¢æ¢ç´¢

```
User: ã€Œä»£ã€…æœ¨å…¬åœ’å‘¨è¾ºã‚‚è¦‹ã›ã¦ã€
  â†“
Bot: ã€Œä»£ã€…æœ¨å…¬åœ’ã‚¨ãƒªã‚¢ã‚’è¡¨ç¤ºã—ã¾ã™ã€
  â†“ [åœ°å›³ãŒã‚¹ãƒ ãƒ¼ã‚ºã«ç§»å‹•]
  â†“ [ä»£ã€…æœ¨å…¬åœ’ã‚¨ãƒªã‚¢ãŒãƒã‚¤ãƒ©ã‚¤ãƒˆ]
  â†“ [æ–°ã—ã„ãƒ”ãƒ³ãŒè¿½åŠ è¡¨ç¤º]
  â†“
Bot: ã€Œä»£ã€…æœ¨å…¬åœ’å‘¨è¾ºã«7ã¤ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ãŒã‚ã‚Šã¾ã™ã€
```

---

## å®Ÿè£…ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

### ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

```typescript
// components/ChatWithMap.tsx

import React, { useState, useRef } from 'react';
import ChatPanel from './ChatPanel';
import MapPanel from './MapPanel';

export default function ChatWithMap() {
  const [activities, setActivities] = useState<Activity[]>([]);
  const [selectedActivity, setSelectedActivity] = useState<Activity | null>(null);
  const mapRef = useRef<GoogleMap>(null);

  const handleChatResponse = (newActivities: Activity[]) => {
    setActivities(newActivities);
    
    // åœ°å›³ã«ãƒãƒ¼ã‚«ãƒ¼è¿½åŠ 
    if (mapRef.current) {
      mapRef.current.addMarkers(newActivities);
      mapRef.current.fitBounds(newActivities);
    }
  };

  const handleActivityHover = (activity: Activity) => {
    setSelectedActivity(activity);
    mapRef.current?.highlightMarker(activity.id);
  };

  const handleMarkerClick = (activity: Activity) => {
    setSelectedActivity(activity);
    // ãƒãƒ£ãƒƒãƒˆãƒ‘ãƒãƒ«ã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
    scrollToChatCard(activity.id);
  };

  return (
    <div className="flex h-screen">
      <ChatPanel 
        onResponse={handleChatResponse}
        activities={activities}
        onActivityHover={handleActivityHover}
        selectedActivity={selectedActivity}
      />
      
      <MapPanel
        ref={mapRef}
        activities={activities}
        onMarkerClick={handleMarkerClick}
        selectedActivity={selectedActivity}
      />
    </div>
  );
}
```

### åœ°å›³ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

```typescript
// components/MapPanel.tsx

import React, { useEffect, useRef, forwardRef, useImperativeHandle } from 'react';
import { GoogleMap, useJsApiLoader, Marker, InfoWindow } from '@react-google-maps/api';

interface MapPanelProps {
  activities: Activity[];
  onMarkerClick: (activity: Activity) => void;
  selectedActivity: Activity | null;
}

const MapPanel = forwardRef((props: MapPanelProps, ref) => {
  const { activities, onMarkerClick, selectedActivity } = props;
  const [map, setMap] = useState<google.maps.Map | null>(null);
  const [markers, setMarkers] = useState<Map<string, google.maps.Marker>>(new Map());

  const { isLoaded } = useJsApiLoader({
    googleMapsApiKey: process.env.NEXT_PUBLIC_GOOGLE_MAPS_API_KEY!,
    libraries: ['places', 'visualization'],
  });

  // å¤–éƒ¨ã‹ã‚‰å‘¼ã³å‡ºã›ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å…¬é–‹
  useImperativeHandle(ref, () => ({
    addMarkers: (newActivities: Activity[]) => {
      // ãƒãƒ¼ã‚«ãƒ¼è¿½åŠ ãƒ­ã‚¸ãƒƒã‚¯
    },
    fitBounds: (activities: Activity[]) => {
      // ç¯„å›²èª¿æ•´ãƒ­ã‚¸ãƒƒã‚¯
    },
    highlightMarker: (activityId: string) => {
      // ãƒãƒ¼ã‚«ãƒ¼ãƒã‚¤ãƒ©ã‚¤ãƒˆãƒ­ã‚¸ãƒƒã‚¯
    },
  }));

  useEffect(() => {
    if (!map || !activities.length) return;

    // ãƒãƒ¼ã‚«ãƒ¼è¿½åŠ 
    activities.forEach(activity => {
      const marker = new google.maps.Marker({
        position: { lat: activity.lat, lng: activity.lng },
        map,
        icon: createCustomIcon(activity),
        animation: google.maps.Animation.DROP,
      });

      marker.addListener('click', () => {
        onMarkerClick(activity);
      });

      markers.set(activity.id, marker);
    });

    // å…¨ãƒãƒ¼ã‚«ãƒ¼ãŒè¦‹ãˆã‚‹ã‚ˆã†ã«èª¿æ•´
    const bounds = new google.maps.LatLngBounds();
    activities.forEach(activity => {
      bounds.extend({ lat: activity.lat, lng: activity.lng });
    });
    map.fitBounds(bounds);

  }, [activities, map]);

  if (!isLoaded) return <div>Loading map...</div>;

  return (
    <div className="w-full h-full">
      <GoogleMap
        mapContainerStyle={{ width: '100%', height: '100%' }}
        center={{ lat: 35.6580, lng: 139.7016 }} // æ¸‹è°·
        zoom={14}
        onLoad={setMap}
        options={{
          styles: customMapStyles, // ã‚«ã‚¹ã‚¿ãƒ ã‚¹ã‚¿ã‚¤ãƒ«
          disableDefaultUI: false,
          zoomControl: true,
          streetViewControl: true,
        }}
      >
        {selectedActivity && (
          <InfoWindow
            position={{ lat: selectedActivity.lat, lng: selectedActivity.lng }}
            onCloseClick={() => onMarkerClick(null)}
          >
            <ActivityInfoWindow activity={selectedActivity} />
          </InfoWindow>
        )}
      </GoogleMap>
    </div>
  );
});
```

---

## ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

### 1. ãƒãƒ¼ã‚«ãƒ¼ä»®æƒ³åŒ–

```typescript
// å¤§é‡ã®ãƒãƒ¼ã‚«ãƒ¼ãŒã‚ã‚‹å ´åˆã¯ã€è¡¨ç¤ºç¯„å›²å†…ã®ã¿ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
function getVisibleMarkers(map: google.maps.Map, allActivities: Activity[]) {
  const bounds = map.getBounds();
  if (!bounds) return allActivities;

  return allActivities.filter(activity => {
    return bounds.contains({ lat: activity.lat, lng: activity.lng });
  });
}
```

### 2. ãƒãƒ¼ã‚«ãƒ¼ã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°

```typescript
// ãƒãƒ¼ã‚«ãƒ¼ã‚¢ã‚¤ã‚³ãƒ³ã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥
const iconCache = new Map<string, string>();

function getCachedIcon(activity: Activity): string {
  const cacheKey = `${activity.category}-${activity.price}`;
  
  if (!iconCache.has(cacheKey)) {
    iconCache.set(cacheKey, createMarkerSVG(activity));
  }
  
  return iconCache.get(cacheKey)!;
}
```

### 3. ãƒ‡ãƒã‚¦ãƒ³ã‚¹å‡¦ç†

```typescript
// åœ°å›³ã®ç§»å‹•ã‚¤ãƒ™ãƒ³ãƒˆã‚’ãƒ‡ãƒã‚¦ãƒ³ã‚¹
const debouncedMapMove = debounce(() => {
  // æ–°ã—ã„ã‚¨ãƒªã‚¢ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ã‚’èª­ã¿è¾¼ã¿
  loadActivitiesInBounds(map.getBounds());
}, 300);

map.addListener('bounds_changed', debouncedMapMove);
```

---

## ãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œ

### ã‚¹ãƒ¯ã‚¤ãƒ—ã‚¸ã‚§ã‚¹ãƒãƒ£ãƒ¼

```typescript
// ãƒ¢ãƒã‚¤ãƒ«ã§ã¯åœ°å›³ã¨ãƒãƒ£ãƒƒãƒˆã‚’ã‚¹ãƒ¯ã‚¤ãƒ—ã§åˆ‡ã‚Šæ›¿ãˆ
import { useSwipeable } from 'react-swipeable';

const handlers = useSwipeable({
  onSwipedLeft: () => setActivePanel('map'),
  onSwipedRight: () => setActivePanel('chat'),
});

<div {...handlers}>
  {activePanel === 'chat' ? <ChatPanel /> : <MapPanel />}
</div>
```

### ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ

```css
/* ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—: æ¨ªä¸¦ã³ */
@media (min-width: 768px) {
  .chat-map-container {
    display: flex;
  }
  .chat-panel {
    width: 40%;
  }
  .map-panel {
    width: 60%;
  }
}

/* ãƒ¢ãƒã‚¤ãƒ«: ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ */
@media (max-width: 767px) {
  .chat-map-container {
    display: block;
  }
  .chat-panel,
  .map-panel {
    width: 100%;
    height: 50vh;
  }
}
```

---

## ã‚³ã‚¹ãƒˆå½±éŸ¿

### Google Maps JavaScript API

| æ©Ÿèƒ½ | ç„¡æ–™æ  | è¶…éæ™‚æ–™é‡‘ |
|------|--------|-----------|
| Dynamic Maps | 28,000å›/æœˆ | $7/1000å› |
| Static Maps | 28,000å›/æœˆ | $2/1000å› |
| Places Details | åˆ¶é™ãªã— | æ—¢å­˜æ–™é‡‘ |

**æƒ³å®š**: æœˆé–“5,000ã‚»ãƒƒã‚·ãƒ§ãƒ³ â†’ **ç„¡æ–™æ å†…ã§åã¾ã‚‹**

---

## ã¾ã¨ã‚

åœ°å›³çµ±åˆã«ã‚ˆã‚Šï¼š

âœ… **ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ãŒåŠ‡çš„ã«å‘ä¸Š**
- è¦–è¦šçš„ã«å ´æ‰€ã‚’æŠŠæ¡
- è·é›¢æ„ŸãŒç›´æ„Ÿçš„ã«åˆ†ã‹ã‚‹
- æ¢ç´¢ãŒæ¥½ã—ããªã‚‹

âœ… **ã‚³ãƒ³ãƒãƒ¼ã‚¸ãƒ§ãƒ³å‘ä¸Š**
- ã€Œè¿‘ã„ã€ã¨ã„ã†ç†ç”±ã§é¸ã°ã‚Œã‚„ã™ã„
- è¤‡æ•°ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ã®çµ„ã¿åˆã‚ã›ãŒå®¹æ˜“
- ã€Œã¤ã„ã§ã«å¯„ã‚Œã‚‹ã€ç™ºè¦‹

âœ… **å·®åˆ¥åŒ–**
- ä»–ã®OTAã«ã¯ãªã„ä½“é¨“
- ãƒãƒ£ãƒƒãƒˆ Ã— åœ°å›³ã®èåˆ
- ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãªæ¢ç´¢

æ¬¡ã«ã€Œãƒã‚¤ã‚¯ãƒ­ã‚¨ã‚¯ã‚¹ãƒšãƒªã‚¨ãƒ³ã‚¹ã€ã‚³ãƒ³ã‚»ãƒ—ãƒˆã«ã¤ã„ã¦è©³ã—ãæ›¸ãã¾ã™ï¼

