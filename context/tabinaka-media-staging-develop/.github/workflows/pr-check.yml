name: PR Check

on:
  pull_request:
    branches: [main, develop]

jobs:
  quick-check:
    name: ðŸš€ é«˜é€Ÿãƒã‚§ãƒƒã‚¯
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: "20"
          cache: "npm"

      - name: Install dependencies
        run: npm ci

      - name: ESLint ãƒã‚§ãƒƒã‚¯
        run: npm run lint

      - name: åž‹ãƒã‚§ãƒƒã‚¯
        run: npm run type-check

      - name: ãƒ“ãƒ«ãƒ‰ç¢ºèª
        run: npm run build

  size-check:
    name: ðŸ“Š ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚ºãƒã‚§ãƒƒã‚¯
    runs-on: ubuntu-latest
    needs: quick-check

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: "20"
          cache: "npm"

      - name: Install dependencies
        run: npm ci

      - name: Build and analyze
        run: |
          npm run build
          echo "### ðŸ“¦ Build Output Size" >> $GITHUB_STEP_SUMMARY
          echo "\`\`\`" >> $GITHUB_STEP_SUMMARY
          du -sh .next/ >> $GITHUB_STEP_SUMMARY
          echo "\`\`\`" >> $GITHUB_STEP_SUMMARY

  pr-summary:
    name: ðŸ“‹ PR Summary
    runs-on: ubuntu-latest
    needs: [quick-check, size-check]
    if: always()

    steps:
      - name: Create PR Summary
        run: |
          echo "## ðŸ” PR Check Results" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY

          if [ "${{ needs.quick-check.result }}" == "success" ]; then
            echo "âœ… **åŸºæœ¬ãƒã‚§ãƒƒã‚¯**: PASSED" >> $GITHUB_STEP_SUMMARY
          else
            echo "âŒ **åŸºæœ¬ãƒã‚§ãƒƒã‚¯**: FAILED" >> $GITHUB_STEP_SUMMARY
          fi

          if [ "${{ needs.size-check.result }}" == "success" ]; then
            echo "âœ… **ã‚µã‚¤ã‚ºãƒã‚§ãƒƒã‚¯**: PASSED" >> $GITHUB_STEP_SUMMARY
          else
            echo "âŒ **ã‚µã‚¤ã‚ºãƒã‚§ãƒƒã‚¯**: FAILED" >> $GITHUB_STEP_SUMMARY
          fi

          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ðŸ“ ãƒã‚§ãƒƒã‚¯å†…å®¹" >> $GITHUB_STEP_SUMMARY
          echo "- ESLint ã«ã‚ˆã‚‹é™çš„è§£æž" >> $GITHUB_STEP_SUMMARY
          echo "- TypeScript åž‹ãƒã‚§ãƒƒã‚¯" >> $GITHUB_STEP_SUMMARY
          echo "- Next.js ãƒ“ãƒ«ãƒ‰ç¢ºèª" >> $GITHUB_STEP_SUMMARY
          echo "- ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚ºæ¸¬å®š" >> $GITHUB_STEP_SUMMARY
